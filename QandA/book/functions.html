<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Functions | Advanced R Companion</title>
  <meta name="description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Functions | Advanced R Companion" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Functions | Advanced R Companion" />
  
  <meta name="twitter:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  

<meta name="author" content="R4DS Reading Group" />


<meta name="date" content="2020-05-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="control-flow.html"/>
<link rel="next" href="environments.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="images/r4ds.png" style="width:300px;height:180px;padding-bottom:0px;"></img>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="welcome.html"><a href="welcome.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="names-and-values.html"><a href="names-and-values.html"><i class="fa fa-check"></i><b>2</b> Names and Values</a><ul>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#copy-on-modify"><i class="fa fa-check"></i>2.3 Copy-on-modify</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>2.2.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#function-calls"><i class="fa fa-check"></i>2.3.2 Function calls</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#lists"><i class="fa fa-check"></i>2.3.3 Lists</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#character-vectors"><i class="fa fa-check"></i>2.3.5 Character vectors</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>2.3.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#object-size"><i class="fa fa-check"></i>2.4.1 Object size</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#modify-in-place"><i class="fa fa-check"></i>2.5.1 Modify-in-place</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#scalars"><i class="fa fa-check"></i>3.2.1 Scalars</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#missing-values"><i class="fa fa-check"></i>3.2.3 Missing values</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#testing-and-coercion"><i class="fa fa-check"></i>3.2.4 Testing and coercion</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setting-attributes"><i class="fa fa-check"></i>3.3.1 Setting Attributes</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setnames"><i class="fa fa-check"></i>3.3.2 setNames</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dimensions"><i class="fa fa-check"></i>3.3.3 Dimensions</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#s3-atomic-vectors"><i class="fa fa-check"></i>3.4 S3 atomic vectors</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dates"><i class="fa fa-check"></i>3.4.2 Dates</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#lists-1"><i class="fa fa-check"></i>3.5.1 Lists</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#data-frames-and-tibbles"><i class="fa fa-check"></i>3.6.8 Data frames and tibbles</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#conclusion"><i class="fa fa-check"></i>Conclusion</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#vectorized"><i class="fa fa-check"></i>VECTORIZED:</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#non-vectorized"><i class="fa fa-check"></i>NON-VECTORIZED:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>4.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#selecting-multiple-elements"><i class="fa fa-check"></i>4.2.1 Selecting multiple elements</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#lists-2"><i class="fa fa-check"></i>4.2.2 lists</a></li>
<li><a href="subsetting.html#section">4.3.1 <code>[[</code></a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#exercise-1"><i class="fa fa-check"></i>4.3.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#missing-and-oob"><i class="fa fa-check"></i>4.3.3 Missing and OOB</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-atomic"><i class="fa fa-check"></i>LOGICAL ATOMIC</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#list"><i class="fa fa-check"></i>LIST</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#null"><i class="fa fa-check"></i>NULL</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-subsetting"><i class="fa fa-check"></i>4.5.8 Logical subsetting</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra"><i class="fa fa-check"></i>4.5.8 Boolean algebra</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control Flow</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i>5.2.2 Vectorised if</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i>5.3 Loops</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#switch-statement"><i class="fa fa-check"></i>5.2.3 switch statement</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i>5.3.1 common pitfalls</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#exercises-1"><i class="fa fa-check"></i>5.3.3.1 Exercises</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-a-valid-index"><i class="fa fa-check"></i>Assignment to a valid index</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-0"><i class="fa fa-check"></i>Assignment to [0]</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#empty-index"><i class="fa fa-check"></i>Empty index</a></li>
<li><a href="control-flow.html#impossible-index">Impossible Index <code>[[</code></a></li>
<li><a href="control-flow.html#impossible-index--">Impossible Index <code>[[&lt;-</code></a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#undefined-name"><i class="fa fa-check"></i>Undefined name</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#out-of-bounds"><i class="fa fa-check"></i>Out of Bounds</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#conclusion-1"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#complexity"><i class="fa fa-check"></i>Complexity</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#primitives"><i class="fa fa-check"></i>6.2.2 Primitives</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercises-2"><i class="fa fa-check"></i>6.2.5.1 Exercises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i>6.3 Function composition</a><ul>
<li class="chapter" data-level="6.0.1" data-path="functions.html"><a href="functions.html#nested"><i class="fa fa-check"></i><b>6.0.1</b> Nested</a></li>
<li class="chapter" data-level="6.0.2" data-path="functions.html"><a href="functions.html#intermediate"><i class="fa fa-check"></i><b>6.0.2</b> Intermediate</a></li>
<li class="chapter" data-level="6.0.3" data-path="functions.html"><a href="functions.html#piping"><i class="fa fa-check"></i><b>6.0.3</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i>6.4 Lexical scoping</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#a-fresh-start"><i class="fa fa-check"></i>6.4.3 A fresh start</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i>6.5 Lazy evaluation</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i>6.5.1 Promises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i>6.5.2 Default arguments</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-2"><i class="fa fa-check"></i>6.5.4.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-3"><i class="fa fa-check"></i>6.5.4.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#dot-dot-dot"><i class="fa fa-check"></i>6.6 dot dot dot</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-4"><i class="fa fa-check"></i>6.6.1.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exit-handlers"><i class="fa fa-check"></i>6.7.4 Exit handlers</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-5"><i class="fa fa-check"></i>6.7.5.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-6"><i class="fa fa-check"></i>6.7.5.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i>6.8.4 Replacement functions</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-7"><i class="fa fa-check"></i>6.8.6.3 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i>7.2.3 Parents</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#getting-and-setting"><i class="fa fa-check"></i>7.2.5 Getting and setting</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i>7.2.6 Advanced bindings</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#exercises-3"><i class="fa fa-check"></i>7.3.1.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#function-enviornment"><i class="fa fa-check"></i>7.4.2 Function enviornment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i>7.4.3 Namespaces</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#data-structures"><i class="fa fa-check"></i>7.6 Data Structures</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R Companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Functions</h1>
<div id="primitives" class="section level2 unnumbered">
<h2>6.2.2 Primitives</h2>
<div class="question">
<p>So if you are familiar with C can you just write a function in C <em>in</em> R? What does that process look like? I think this is a bigger question of digging into the relationship between C and R.</p>
</div>
<p>We can use RCPP!</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">Rcpp<span class="op">::</span><span class="kw">cppFunction</span>(<span class="st">&#39;#include&lt;string&gt;</span></a>
<a class="sourceLine" id="cb220-2" data-line-number="2"><span class="st">  std::string IPA() {</span></a>
<a class="sourceLine" id="cb220-3" data-line-number="3"><span class="st">  std::string val = &quot;IPAs suck&quot;;    </span></a>
<a class="sourceLine" id="cb220-4" data-line-number="4"><span class="st">  return val;</span></a>
<a class="sourceLine" id="cb220-5" data-line-number="5"><span class="st">  }&#39;</span>)</a>
<a class="sourceLine" id="cb220-6" data-line-number="6">val &lt;-<span class="st"> </span><span class="kw">IPA</span>()</a>
<a class="sourceLine" id="cb220-7" data-line-number="7">val</a></code></pre></div>
<pre><code>## [1] &quot;IPAs suck&quot;</code></pre>
</div>
<div id="exercises-2" class="section level2 unnumbered">
<h2>6.2.5.1 Exercises</h2>
<div class="question">
<p><a href="https://github.com/Tazinho/Advanced-R-Solutions/blob/5043d9b06c7469a010c568ecb85e12bedca75207/2-06-Functions.Rmd#L9">This question is flagged as “started” let’s try to complete it!</a></p>
</div>
<ol style="list-style-type: decimal">
<li><p><strong><span class="Q">Q</span></strong>: Given a name, like <code>&quot;mean&quot;</code>, <code>match.fun()</code> lets you find a function. Given a function, can you find its name? Why doesn’t that make sense in R?</p>
<p><strong><span class="started">A</span></strong>: A name can only point to a single object, but an object can be pointed to by 0, 1, or many names. What are names of the functions in the following block?</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">  <span class="cf">function</span>(x) <span class="kw">sd</span>(x) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(x)</a></code></pre></div>
<pre><code>## function(x) sd(x) / mean(x)</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">  f1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))</a>
<a class="sourceLine" id="cb224-2" data-line-number="2">  f2 &lt;-<span class="st"> </span>f1</a>
<a class="sourceLine" id="cb224-3" data-line-number="3">  f3 &lt;-<span class="st"> </span>f1</a></code></pre></div></li>
</ol>
<p>There isn’t a 1 to 1 mapping between functions and names in R. Multiple names may point to the same function as we see for <code>f1</code>, <code>f2</code>, and <code>f3</code>. Also, each function has its own environment so it’s possible that two functions might have the same “code” but are not the same because they have different environments (or closures). Lastly, anonymous functions don’t have names so we’d have no way to look these up.</p>
<p>That said…. we could find the names of our functions if they are all in the global environment:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1"><span class="kw">names</span>(<span class="kw">which</span>(<span class="kw">sapply</span>(<span class="kw">mget</span>(<span class="kw">lsf.str</span>()), <span class="cf">function</span>(x) <span class="kw">body</span>(x) <span class="op">==</span><span class="st"> </span><span class="kw">body</span>(<span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))))))</a></code></pre></div>
<pre><code>## [1] &quot;f1&quot; &quot;f2&quot; &quot;f3&quot;</code></pre>
<p>But I don’t think this scales when functions are outside of the global environment</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1">e1 &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">env</span>(<span class="dt">f1 =</span> <span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))) </a>
<a class="sourceLine" id="cb227-2" data-line-number="2">e2 &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">env</span>(<span class="dt">f2 =</span> <span class="cf">function</span>(x) (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)))</a></code></pre></div>
</div>
<div id="function-composition" class="section level2 unnumbered">
<h2>6.3 Function composition</h2>
<div class="question">
<p>When comparing nested, intermediate, and piping functions, it looks like Hadley flips the order of <code>f()</code> and <code>g()</code> between bullet points</p>
</div>
<p>It does look like he does that!</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(z) {</a>
<a class="sourceLine" id="cb228-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;g is:&quot;</span>, z)</a>
<a class="sourceLine" id="cb228-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb228-4" data-line-number="4"></a>
<a class="sourceLine" id="cb228-5" data-line-number="5">g &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb228-6" data-line-number="6">  x <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb228-7" data-line-number="7">}</a></code></pre></div>
<div id="nested" class="section level3">
<h3><span class="header-section-number">6.0.1</span> Nested</h3>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">f</span>(<span class="kw">g</span>(<span class="dv">2</span>))</a></code></pre></div>
<pre><code>## g is: 4</code></pre>
</div>
<div id="intermediate" class="section level3">
<h3><span class="header-section-number">6.0.2</span> Intermediate</h3>
<p>This is written in the book as <code>y &lt;- f(x); g(y)</code> but should be flipped to <code>y &lt;- g(x); f(y)</code> if we are to follow the nested example</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">g</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="kw">f</span>(y)</a></code></pre></div>
<pre><code>## g is: 4</code></pre>
</div>
<div id="piping" class="section level3">
<h3><span class="header-section-number">6.0.3</span> Piping</h3>
<p>This also needs to be flipped from <code>x %&gt;% f() %&gt;% g()</code> to <code>x %&gt;% g() %&gt;% f()</code></p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1"><span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">g</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">f</span>()</a></code></pre></div>
<pre><code>## g is: 4</code></pre>
</div>
</div>
<div id="lexical-scoping" class="section level2 unnumbered">
<h2>6.4 Lexical scoping</h2>
<div class="question">
<p>“The scoping rules use a parse-time, rather than a run-time structure”? What is “parse-time” and “run-time”? How do they differ?</p>
</div>
<p>parse-time is when the function gets defined: when the formals and body get set. run-time is when it actually gets called. This function doesn’t get past parse-time because of the syntax error</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">get_state &lt;-<span class="st"> </span><span class="cf">function</span>(in_df, state_name){</a>
<a class="sourceLine" id="cb235-2" data-line-number="2">  out_df % in_df[in_df<span class="op">$</span>state <span class="op">==</span><span class="st"> </span>state_name, ]</a>
<a class="sourceLine" id="cb235-3" data-line-number="3">  <span class="kw">return</span>(out_df)</a>
<a class="sourceLine" id="cb235-4" data-line-number="4">}</a></code></pre></div>
<pre><code>get_state &lt;- function(in_df, state_name){
  out_df % in_df[in_df$state == state_name, ]

Error: unexpected input in:

&quot;get_state &lt;- function(in_df, state_name){
  out_df % in_df[in_df$state == state_name, ]&quot;
  return(out_df)

Error: object &#39;out_df&#39; not found
}

Error: unexpected &#39;}&#39; in &quot;}&quot;</code></pre>
<p>This function will get parsed successfully but could fail at run at run-time if the input data frame doesn’t have a column named state:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">get_state &lt;-<span class="st"> </span><span class="cf">function</span>(in_df, state_name){</a>
<a class="sourceLine" id="cb237-2" data-line-number="2">  out_df &lt;-<span class="st"> </span>in_df[in_df<span class="op">$</span>state <span class="op">==</span><span class="st"> </span>state_name, ]</a>
<a class="sourceLine" id="cb237-3" data-line-number="3">  <span class="kw">return</span>(out_df)</a>
<a class="sourceLine" id="cb237-4" data-line-number="4">}  </a>
<a class="sourceLine" id="cb237-5" data-line-number="5"></a>
<a class="sourceLine" id="cb237-6" data-line-number="6"><span class="kw">get_state</span>(iris, <span class="st">&#39;setosa&#39;</span>)</a></code></pre></div>
<pre><code>## [1] Sepal.Length Sepal.Width  Petal.Length Petal.Width  Species     
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>At R’s build-time, if you want to run a function from a package that isn’t loaded it will not throw an error but at run-time it will if the required package is not loaded:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">func_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(df, x) {</a>
<a class="sourceLine" id="cb239-2" data-line-number="2">  <span class="kw">select</span>({{ df }}, {{ x }})</a>
<a class="sourceLine" id="cb239-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb239-4" data-line-number="4"></a>
<a class="sourceLine" id="cb239-5" data-line-number="5">test_tbl &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x1 =</span> <span class="kw">runif</span>(<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb239-6" data-line-number="6">             <span class="dt">x2 =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb239-7" data-line-number="7">             <span class="dt">x3 =</span> <span class="kw">rpois</span>(<span class="dv">5</span>, <span class="dt">lambda =</span> <span class="dv">1</span>))</a></code></pre></div>
<p>Without <code>dplyr</code> this will fail</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1"><span class="kw">func_1</span>(test_tbl, x1)</a></code></pre></div>
<pre><code>Error in select({: could not find function &quot;select&quot;</code></pre>
<p>This will work:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb242-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb242-3" data-line-number="3"><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></a>
<a class="sourceLine" id="cb242-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></a>
<a class="sourceLine" id="cb242-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb242-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb242-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></a>
<a class="sourceLine" id="cb242-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb242-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb242-10" data-line-number="10"><span class="kw">func_1</span>(test_tbl, x1)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 1
##       x1
##    &lt;dbl&gt;
## 1 0.348 
## 2 0.183 
## 3 0.0256
## 4 0.411 
## 5 0.956</code></pre>
</div>
<div id="a-fresh-start" class="section level2 unnumbered">
<h2>6.4.3 A fresh start</h2>
<div class="question">
<p>How would we change this code so that the second call of <code>g11()</code> is 2?</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">g11 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb244-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)) {</a>
<a class="sourceLine" id="cb244-3" data-line-number="3">    a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb244-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb244-5" data-line-number="5">    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb244-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb244-7" data-line-number="7">  a</a>
<a class="sourceLine" id="cb244-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb244-9" data-line-number="9"></a>
<a class="sourceLine" id="cb244-10" data-line-number="10"><span class="kw">g11</span>()</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">g11 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb246-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)) {</a>
<a class="sourceLine" id="cb246-3" data-line-number="3">    a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb246-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb246-5" data-line-number="5">    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb246-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb246-7" data-line-number="7">  a &lt;&lt;-<span class="st"> </span>a</a>
<a class="sourceLine" id="cb246-8" data-line-number="8">  a</a>
<a class="sourceLine" id="cb246-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb246-10" data-line-number="10"></a>
<a class="sourceLine" id="cb246-11" data-line-number="11"><span class="kw">g11</span>()</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="lazy-evaluation" class="section level2 unnumbered">
<h2>6.5 Lazy evaluation</h2>
<div class="question">
<p>“This allows you to do things like include potentially expensive computations in function arguments that will only be evaluated if needed”</p>
<p>Does anyone have an example of this? We discussed a function that will only perform expensive tasks given the context of the function perhaps?</p>
</div>
<p>Maybe a situation where we can give a function default arguments where <code>sample</code>is a stand in for longer expensive functions like different fancy modeling techniques? We can workshop this…</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">mega_model &lt;-<span class="st"> </span><span class="cf">function</span>(values, <span class="dt">x =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dv">10</span>), <span class="dt">y =</span> <span class="kw">sample</span>(<span class="dv">200</span><span class="op">:</span><span class="dv">300</span>, <span class="dv">10</span>), <span class="dt">z =</span> <span class="kw">sample</span>(<span class="dv">300</span><span class="op">:</span><span class="dv">400</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb248-2" data-line-number="2">) {</a>
<a class="sourceLine" id="cb248-3" data-line-number="3">  dplyr<span class="op">::</span><span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb248-4" data-line-number="4">    <span class="kw">is.numeric</span>(values) <span class="op">~</span><span class="st"> </span>x,</a>
<a class="sourceLine" id="cb248-5" data-line-number="5">    <span class="kw">is.character</span>(values) <span class="op">~</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb248-6" data-line-number="6">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>z</a>
<a class="sourceLine" id="cb248-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb248-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb248-9" data-line-number="9"></a>
<a class="sourceLine" id="cb248-10" data-line-number="10"><span class="kw">mega_model</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</a></code></pre></div>
<pre><code>##  [1] 249 240 236 221 273 272 274 241 224 237</code></pre>
</div>
<div id="promises" class="section level2 unnumbered">
<h2>6.5.1 Promises</h2>
<div class="question">
<p>Can we discuss the order that this happening in? Is it that <code>Calculating...</code> is printed, then <code>x*2</code> then <code>x*2</code> again? I am still reading this as: <code>h03(double(20), double(20))</code> which is an incorrect mental model because the message is only printed once…</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">double &lt;-<span class="st"> </span><span class="cf">function</span>(x) { </a>
<a class="sourceLine" id="cb250-2" data-line-number="2">  <span class="kw">message</span>(<span class="st">&quot;Calculating...&quot;</span>)</a>
<a class="sourceLine" id="cb250-3" data-line-number="3">  x <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb250-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb250-5" data-line-number="5"></a>
<a class="sourceLine" id="cb250-6" data-line-number="6">h03 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb250-7" data-line-number="7">  <span class="kw">c</span>(x, x)</a>
<a class="sourceLine" id="cb250-8" data-line-number="8">}</a></code></pre></div>
</div>
<div class="TODO">
<p>Explain what’s happeining here below in words, and restructure the promise image to make more sense</p>
</div>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1">double &lt;-<span class="st"> </span><span class="cf">function</span>(y) {</a>
<a class="sourceLine" id="cb251-2" data-line-number="2">  <span class="kw">message</span>(<span class="st">&quot;Calculating...&quot;</span>)</a>
<a class="sourceLine" id="cb251-3" data-line-number="3">  <span class="kw">cat</span>(<span class="st">&quot;double before</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb251-4" data-line-number="4">  <span class="kw">print</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(y))</a>
<a class="sourceLine" id="cb251-5" data-line-number="5">  <span class="kw">force</span>(y)</a>
<a class="sourceLine" id="cb251-6" data-line-number="6">  <span class="kw">cat</span>(<span class="st">&quot;double after</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb251-7" data-line-number="7">  <span class="kw">print</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(y))</a>
<a class="sourceLine" id="cb251-8" data-line-number="8">  y <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb251-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb251-10" data-line-number="10">h03 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb251-11" data-line-number="11">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;h03 before</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb251-12" data-line-number="12">  <span class="kw">print</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(x))</a>
<a class="sourceLine" id="cb251-13" data-line-number="13">  <span class="kw">force</span>(x)</a>
<a class="sourceLine" id="cb251-14" data-line-number="14">  <span class="kw">cat</span>(<span class="st">&quot;h03 after</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb251-15" data-line-number="15">  <span class="kw">print</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(x))</a>
<a class="sourceLine" id="cb251-16" data-line-number="16">  <span class="kw">c</span>(x, x)</a>
<a class="sourceLine" id="cb251-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb251-18" data-line-number="18"><span class="kw">double</span>(<span class="kw">h03</span>(<span class="dv">20</span>))</a></code></pre></div>
<pre><code>## Calculating...</code></pre>
<pre><code>## double before</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;pryr&#39;:
##   method      from
##   print.bytes Rcpp</code></pre>
<pre><code>## $code
## h03(20)
## 
## $env
## &lt;environment: R_GlobalEnv&gt;
## 
## $evaled
## [1] FALSE
## 
## $value
## NULL
## 
## h03 before
## $code
## [1] 20
## 
## $env
## &lt;environment: R_GlobalEnv&gt;
## 
## $evaled
## [1] FALSE
## 
## $value
## NULL
## 
## h03 after
## $code
## [1] 20
## 
## $env
## NULL
## 
## $evaled
## [1] TRUE
## 
## $value
## [1] 20
## 
## double after
## $code
## h03(20)
## 
## $env
## NULL
## 
## $evaled
## [1] TRUE
## 
## $value
## [1] 20 20</code></pre>
<pre><code>## [1] 40 40</code></pre>
<p><img src="images/promise.png" width="728" style="display: block; margin: auto;" /></p>
<div class="question">
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">plop &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) a <span class="op">*</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="kw">plop</span>(<span class="dv">2</span>, var_doesnt_exist)</a></code></pre></div>
<pre><code>## [1] 20</code></pre>
<p><code>var_doesnt_exist</code> is a promise within <code>g</code>, we use the promises within <code>g</code> when we call <code>f</code> but <code>f</code> never uses its second argument so this runs without a problem. When would we want to leverage this behavior?</p>
</div>
<p>The unevaluated <code>var_doesnt_exist</code> doesn’t exist , but we can use <code>substitute</code> to to get the expression out of a promise! If we modify our function we can play with the expression contained in b:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">plop &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) {</a>
<a class="sourceLine" id="cb259-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;You entered&quot;</span>, <span class="kw">deparse</span>(<span class="kw">substitute</span>(b)), <span class="st">&quot;as `b` </span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb259-3" data-line-number="3">  a <span class="op">*</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb259-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb259-5" data-line-number="5"><span class="kw">plop</span>(<span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">b =</span> var_doesnt_exist)</a></code></pre></div>
<pre><code>## You entered var_doesnt_exist as `b`</code></pre>
<pre><code>## [1] 20</code></pre>
<p>We can even evaluate <code>b</code> and use it to create a <code>dplyr</code> like <code>pull</code> function:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1">plop &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) {</a>
<a class="sourceLine" id="cb262-2" data-line-number="2">  <span class="kw">eval</span>(<span class="kw">substitute</span>(b), <span class="dt">envir =</span> a)</a>
<a class="sourceLine" id="cb262-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb262-4" data-line-number="4"><span class="kw">plop</span>(iris, Species)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##  [1] setosa setosa setosa setosa setosa setosa setosa setosa setosa setosa
## Levels: setosa versicolor virginica</code></pre>
</div>
<div id="default-arguments" class="section level2 unnumbered">
<h2>6.5.2 Default arguments</h2>
<div class="question">
<p>I don’t quite understand why <code>x = ls()</code> is different from <code>ls()</code> here; aren’t we still assigning <code>x = ls()</code> but without specifying x?</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">h05 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="kw">ls</span>()) {</a>
<a class="sourceLine" id="cb264-2" data-line-number="2">  a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb264-3" data-line-number="3">  x</a>
<a class="sourceLine" id="cb264-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb264-5" data-line-number="5"></a>
<a class="sourceLine" id="cb264-6" data-line-number="6"><span class="co"># this makes sense to me</span></a>
<a class="sourceLine" id="cb264-7" data-line-number="7"><span class="kw">h05</span>()</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;x&quot;</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1"><span class="co"># how is this different from above?</span></a>
<a class="sourceLine" id="cb266-2" data-line-number="2"><span class="kw">h05</span>(<span class="kw">ls</span>())</a></code></pre></div>
<pre><code>##  [1] &quot;a&quot;                     &quot;answer&quot;                &quot;as_tb&quot;                
##  [4] &quot;casewhen_func&quot;         &quot;controlflow_functions&quot; &quot;custom_attr&quot;          
##  [7] &quot;df&quot;                    &quot;df_coltypes&quot;           &quot;df_non_syntactic_name&quot;
## [10] &quot;df_x&quot;                  &quot;double&quot;                &quot;example2223&quot;          
## [13] &quot;f&quot;                     &quot;f1&quot;                    &quot;f2&quot;                   
## [16] &quot;f3&quot;                    &quot;for_func&quot;              &quot;func_1&quot;               
## [19] &quot;g&quot;                     &quot;g11&quot;                   &quot;get_state&quot;            
## [22] &quot;h03&quot;                   &quot;h05&quot;                   &quot;i&quot;                    
## [25] &quot;if_else_func&quot;          &quot;if_func&quot;               &quot;ifelse_func&quot;          
## [28] &quot;IPA&quot;                   &quot;l1&quot;                    &quot;l2&quot;                   
## [31] &quot;means&quot;                 &quot;medians&quot;               &quot;mega_model&quot;           
## [34] &quot;my_factor&quot;             &quot;my_matrix&quot;             &quot;my_set&quot;               
## [37] &quot;my_vector&quot;             &quot;mylist&quot;                &quot;new_address&quot;          
## [40] &quot;new_y_address&quot;         &quot;no&quot;                    &quot;no_final&quot;             
## [43] &quot;no_idx&quot;                &quot;old_address&quot;           &quot;out&quot;                  
## [46] &quot;out_list&quot;              &quot;out_vector&quot;            &quot;plop&quot;                 
## [49] &quot;repeat_func&quot;           &quot;subsetting_table&quot;      &quot;switch_func&quot;          
## [52] &quot;test&quot;                  &quot;test_tbl&quot;              &quot;true_one&quot;             
## [55] &quot;true_two&quot;              &quot;v&quot;                     &quot;v_address&quot;            
## [58] &quot;val&quot;                   &quot;var&quot;                   &quot;while_func&quot;           
## [61] &quot;x&quot;                     &quot;x1&quot;                    &quot;x2&quot;                   
## [64] &quot;x3&quot;                    &quot;x4&quot;                    &quot;x5&quot;                   
## [67] &quot;y&quot;                     &quot;y_address&quot;             &quot;yes&quot;                  
## [70] &quot;yes_final&quot;             &quot;yes_idx&quot;</code></pre>
</div>
<p>The difference is where the promise is created. <code>ls()</code> is always evaluated inside <code>h05</code> when <code>x</code> is evaluated. The difference is the environment. When <code>ls()</code> is provided as an explicit parameter, <code>x</code> is a promise whose environment is the global environment. When <code>ls()</code> is a default parameter, it is evaluated in the local environment where it is used.</p>
<p>Hypothesis: does nesting <code>ls()</code> in <code>h05</code> first evaluate <code>ls()</code> then evaluate <code>h05()</code> ?</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb268-2" data-line-number="2">h05 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> {y &lt;-<span class="st"> </span><span class="dv">4</span>;<span class="kw">ls</span>()}) {</a>
<a class="sourceLine" id="cb268-3" data-line-number="3">   a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb268-4" data-line-number="4">   x</a>
<a class="sourceLine" id="cb268-5" data-line-number="5">}</a></code></pre></div>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1"><span class="kw">h05</span>()</a></code></pre></div>
<pre><code>[1] &quot;a&quot; &quot;x&quot; &quot;y&quot;</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1"><span class="kw">ls</span>()</a></code></pre></div>
<pre><code>[1] &quot;h05&quot;</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1">{y &lt;-<span class="st"> </span><span class="dv">4</span>;<span class="kw">ls</span>()} <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">h05</span>()</a></code></pre></div>
<pre><code>[1] &quot;h05&quot; &quot;y&quot;  </code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1"><span class="kw">ls</span>()</a></code></pre></div>
<pre><code>[1] &quot;h05&quot; &quot;y&quot; </code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1"><span class="kw">h05</span>({x &lt;-<span class="st"> </span><span class="dv">5</span>;<span class="kw">ls</span>()})</a></code></pre></div>
<pre><code>[1] &quot;h05&quot; &quot;x&quot;   &quot;y&quot; </code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="kw">ls</span>()</a></code></pre></div>
<pre><code>[1] &quot;h05&quot; &quot;x&quot;   &quot;y&quot; </code></pre>
<p>Notice in all of the latter calls, a is not returned - so it’s not evaluating <code>ls()</code> inside of the function.</p>
</div>
<div id="exercise-2" class="section level2 unnumbered">
<h2>6.5.4.3 Exercise</h2>
<div class="question">
<p>I understand this problem is showing us an example of name masking (the function doesn’t need to use the <code>y = 0</code> argument because it gets <code>y</code> from within the definition of x, but I’m fuzzy on what exactly the <code>;</code> does. What does the syntax <code>{y &lt;- 1; 2}</code> mean? Could it be read as &quot;Set <code>y &lt;- 1</code> and <code>x &lt;- 2</code>?</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb281-2" data-line-number="2">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> {y &lt;-<span class="st"> </span><span class="dv">1</span>; <span class="dv">2</span>}, <span class="dt">y =</span> <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb281-3" data-line-number="3">  <span class="kw">c</span>(x, y)</a>
<a class="sourceLine" id="cb281-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb281-5" data-line-number="5"><span class="kw">f1</span>()</a></code></pre></div>
<pre><code>## [1] 2 1</code></pre>
</div>
<p>The curly brackets are an expression, which can be read as</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1">{</a>
<a class="sourceLine" id="cb283-2" data-line-number="2">  y &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb283-3" data-line-number="3">  <span class="dv">2</span></a>
<a class="sourceLine" id="cb283-4" data-line-number="4">}</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>This is returning <code>2</code> and setting <code>1</code> to <code>y</code>. The colon can be read as a new line in the expression. <code>x</code> is called inside the function and overwrites the argument value of <code>y</code></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> {y &lt;-<span class="st"> </span><span class="dv">1</span>; <span class="dv">2</span>}, <span class="dt">y =</span> <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb285-2" data-line-number="2">  <span class="co"># At this point, neither x nor y have been needed or evaluated. This is &quot;lazy&quot;.</span></a>
<a class="sourceLine" id="cb285-3" data-line-number="3">  <span class="kw">cat</span>(y) </a>
<a class="sourceLine" id="cb285-4" data-line-number="4">  <span class="co"># &quot;Summon the current state of y&quot;. </span></a>
<a class="sourceLine" id="cb285-5" data-line-number="5">  <span class="co"># R looks first in the function env - is there a y there? No</span></a>
<a class="sourceLine" id="cb285-6" data-line-number="6">  <span class="co"># R then looks at the arguments - is there a y there? Yes, it&#39;s 0 -&gt; print out zero </span></a>
<a class="sourceLine" id="cb285-7" data-line-number="7">  <span class="co"># If R had not found y in the arguments, then it would look in the parent environment of the function - the global env.</span></a>
<a class="sourceLine" id="cb285-8" data-line-number="8">  <span class="co"># That&#39;s where it would find y = NULL - but since it already found a default arg, it already stopped evaluating. </span></a>
<a class="sourceLine" id="cb285-9" data-line-number="9">  <span class="kw">cat</span>(x)</a>
<a class="sourceLine" id="cb285-10" data-line-number="10">  <span class="co"># &quot;Summon the current state of x&quot;</span></a>
<a class="sourceLine" id="cb285-11" data-line-number="11">  <span class="co"># x is an expression that first sets y to equal 1 and then returns the number 2 -&gt; print out 2</span></a>
<a class="sourceLine" id="cb285-12" data-line-number="12">  <span class="kw">c</span>(x, <span class="co"># &quot;Summon the current state of x&quot; - x is still the expression that sets y to 1 and then x to 2</span></a>
<a class="sourceLine" id="cb285-13" data-line-number="13">    y) <span class="co"># &quot;Summon the current state of y&quot; - y was set to 1, so y is 1 here.</span></a>
<a class="sourceLine" id="cb285-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb285-15" data-line-number="15"><span class="kw">f1</span>()</a></code></pre></div>
<pre><code>## 02</code></pre>
<pre><code>## [1] 2 1</code></pre>
<p>Compare to:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> {y &lt;-<span class="st"> </span><span class="dv">1</span>; <span class="dv">2</span>}, <span class="dt">y =</span> <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb288-2" data-line-number="2">  <span class="kw">c</span>(y, <span class="co"># &quot;Summon the current state of y&quot; - y has not yet been set to anything else, so it returns zero</span></a>
<a class="sourceLine" id="cb288-3" data-line-number="3">    x) <span class="co"># &quot;Summon the current state of x&quot; - x is still the expression that sets y to 1 and then x to 2</span></a>
<a class="sourceLine" id="cb288-4" data-line-number="4">       <span class="co"># However, y has already been returned - so even though y is now set to 1, it&#39;s called after the previous y and does not affect the previous y.</span></a>
<a class="sourceLine" id="cb288-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb288-6" data-line-number="6">x =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb288-7" data-line-number="7">y =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb288-8" data-line-number="8"><span class="kw">f1</span>()</a></code></pre></div>
<pre><code>## [1] 0 2</code></pre>
</div>
<div id="exercise-3" class="section level2 unnumbered">
<h2>6.5.4.4 Exercise</h2>
<div class="question">
<p>I know this isn’t exactly needed to answer the question, but how do we access a function that has methods? For instance - here I want to dig into the <code>hist</code> function using <code>hist</code></p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1">hist</a></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;hist&quot;)
## &lt;bytecode: 0x7fefd61e6180&gt;
## &lt;environment: namespace:graphics&gt;</code></pre>
<p>does not give me the actual contents of the actual function….</p>
</div>
<p>We need to access is using <code>hist.&lt;method&gt;</code></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1">hist.default</a></code></pre></div>
</div>
<div id="dot-dot-dot" class="section level2 unnumbered">
<h2>6.6 dot dot dot</h2>
<div class="question">
<p>“(See also <code>rlang::list2()</code> to support splicing and to silently ignore trailing commas…” Can we come up with a simple use case for <code>list2</code> here? The docs use <code>list2(a = 1, a = 2, b = 3, b = 4, 5, 6)</code> but how is this different from <code>list</code>?</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1"><span class="kw">identical</span>(</a>
<a class="sourceLine" id="cb293-2" data-line-number="2">  rlang<span class="op">::</span><span class="kw">list2</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">b =</span> <span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>) ,</a>
<a class="sourceLine" id="cb293-3" data-line-number="3">  <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">b =</span> <span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb293-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<p><code>list2</code> is most helpful when we need to force environment variables with data variables. We can see this by creating a function that takes a variable number of arguments:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="kw">library</span>(rlang)</a>
<a class="sourceLine" id="cb295-2" data-line-number="2"></a>
<a class="sourceLine" id="cb295-3" data-line-number="3">numeric_list &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb295-4" data-line-number="4">  dots &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb295-5" data-line-number="5">  num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(dots)</a>
<a class="sourceLine" id="cb295-6" data-line-number="6">  <span class="kw">set_names</span>(num, <span class="kw">names</span>(dots))</a>
<a class="sourceLine" id="cb295-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb295-8" data-line-number="8"></a>
<a class="sourceLine" id="cb295-9" data-line-number="9">numeric_list2 &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb295-10" data-line-number="10">  dots &lt;-<span class="st"> </span><span class="kw">list2</span>(...)</a>
<a class="sourceLine" id="cb295-11" data-line-number="11">  num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(dots)</a>
<a class="sourceLine" id="cb295-12" data-line-number="12">  <span class="kw">set_names</span>(num, <span class="kw">names</span>(dots))</a>
<a class="sourceLine" id="cb295-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb295-14" data-line-number="14"></a>
<a class="sourceLine" id="cb295-15" data-line-number="15"><span class="kw">numeric_list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1"><span class="kw">numeric_list2</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>The main difference with list(…) is that list2(…) enables the <code>!!!</code> syntax to splice lists:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb299-2" data-line-number="2"><span class="kw">numeric_list2</span>(<span class="dv">1</span>, <span class="op">!!!</span><span class="st"> </span>x, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1"><span class="kw">numeric_list</span>(<span class="dv">1</span>, <span class="op">!!!</span><span class="st"> </span>x, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>Error in !x : invalid argument type</code></pre>
<div class="question">
<p>“<code>lapply()</code> uses <code>...</code> to pass <code>na.rm</code> on to <code>mean()</code>” Um, how?</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="ot">NA</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="ot">NA</span>, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb303-2" data-line-number="2"><span class="kw">str</span>(<span class="kw">lapply</span>(x, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## List of 2
##  $ : num 2
##  $ : num 5</code></pre>
</div>
<p>An lapply takes on two main arguments: what you want to loop over and the function to apply to each element. By including <code>...</code> <code>lapply</code> allows you to supply additional arguments which will be passed to the function inside the <code>lapply</code>. In this case, <code>na.rm = TRUE</code> is being applied to mean every time it’s being called in the loop.</p>
</div>
<div id="exercise-4" class="section level2 unnumbered">
<h2>6.6.1.2 Exercise</h2>
<div class="question">
<p>I tried running <code>browser(plot(1:10, col = &quot;red&quot;))</code> to peek under the hood but only got <code>Called from: top level</code> in the console. What am I missing?</p>
</div>
<p>We can use <code>debugonce</code>!</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1"><span class="kw">debugonce</span>(<span class="kw">plot</span>())</a></code></pre></div>
</div>
<div id="exit-handlers" class="section level2 unnumbered">
<h2>6.7.4 Exit handlers</h2>
<div class="question">
<p>“Always set <code>add = TRUE</code> when using <code>on.exit()</code> If you don’t, each call to <code>on.exit()</code> will overwrite the previous exit handler.” What does this mean?</p>
</div>
<p><code>add = TRUE</code> is important when you have more than one <code>on.exit</code> function!</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" data-line-number="1">j08 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb306-2" data-line-number="2">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;a&quot;</span>))</a>
<a class="sourceLine" id="cb306-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;b&quot;</span>), <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb306-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb306-5" data-line-number="5"></a>
<a class="sourceLine" id="cb306-6" data-line-number="6"><span class="kw">j08</span>()</a></code></pre></div>
<pre><code>## a</code></pre>
<pre><code>## b</code></pre>
<div class="question">
<p>Can we go over this code? How does it not change your working directory after you run the function</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" data-line-number="1">cleanup &lt;-<span class="st"> </span><span class="cf">function</span>(dir, code) {</a>
<a class="sourceLine" id="cb309-2" data-line-number="2">  old_dir &lt;-<span class="st"> </span><span class="kw">setwd</span>(dir)</a>
<a class="sourceLine" id="cb309-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">setwd</span>(old_dir), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb309-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb309-5" data-line-number="5">  old_opt &lt;-<span class="st"> </span><span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb309-6" data-line-number="6">  <span class="kw">on.exit</span>(<span class="kw">options</span>(old_opt), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb309-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb309-8" data-line-number="8"></a>
<a class="sourceLine" id="cb309-9" data-line-number="9"></a>
<a class="sourceLine" id="cb309-10" data-line-number="10"><span class="kw">cleanup</span>(<span class="st">&quot;~&quot;</span>)</a>
<a class="sourceLine" id="cb309-11" data-line-number="11"><span class="kw">getwd</span>()</a></code></pre></div>
<pre><code>## [1] &quot;/Users/mayagans/Documents/bookclub-Advanced_R/QandA&quot;</code></pre>
</div>
<p>The behavior of <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/getwd"><code>setwd</code></a> “changing the working directory” is actually a <strong>side effect</strong> of the function - it invisibly returns the previous working directory as the value of the function (potentially for the exact purpose demonstrated). We can use this within our <code>on.exit</code> function to change back to the prior working directory!</p>
<div class="question">
<p>If <code>on.exit</code> fails will it continue onto the next <code>on.exit</code> so long as <code>add == TRUE</code>
?``on.exit fails it’ll continue onto the next one</p>
</div>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb311-2" data-line-number="2">  <span class="kw">on.exit</span>(<span class="kw">stop</span>(<span class="st">&quot;Error&quot;</span>))</a>
<a class="sourceLine" id="cb311-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;yay, still called.&quot;</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb311-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb311-5" data-line-number="5"><span class="kw">f</span>()</a></code></pre></div>
<pre><code>Error in f() : Error
yay, still called.</code></pre>
</div>
<div id="exercise-5" class="section level2 unnumbered">
<h2>6.7.5.4 Exercise</h2>
<div class="question">
<p><a href="https://github.com/Tazinho/Advanced-R-Solutions/blob/5043d9b06c7469a010c568ecb85e12bedca75207/2-06-Functions.Rmd#L350">This question is flagged as “started” let’s try to complete it!</a> Hadley comments in the repo: “I think I’m more interested in supplying a path vs. a logical value here”.</p>
</div>
<p><strong><span class="Q">Q</span></strong>: How does the <code>chdir</code> parameter of <code>source()</code> compare to <code>in_dir()</code>? Why might you prefer one approach to the other?
The <code>in_dir()</code> approach was given in the book as</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" data-line-number="1">    in_dir &lt;-<span class="st"> </span><span class="cf">function</span>(dir, code) {</a>
<a class="sourceLine" id="cb313-2" data-line-number="2">      old &lt;-<span class="st"> </span><span class="kw">setwd</span>(dir)</a>
<a class="sourceLine" id="cb313-3" data-line-number="3">      <span class="kw">on.exit</span>(<span class="kw">setwd</span>(old))</a>
<a class="sourceLine" id="cb313-4" data-line-number="4">      </a>
<a class="sourceLine" id="cb313-5" data-line-number="5">      <span class="kw">force</span>(code)</a>
<a class="sourceLine" id="cb313-6" data-line-number="6">    }</a></code></pre></div>
<p><strong><span class="started">A</span></strong>: <code>in_dir()</code> takes a path to a working directory as an argument. First the working directory is changed accordingly. <code>on.exit()</code> ensures that the modification to the working directory are reset to the initial value when the function exits.</p>
<p>In <code>source()</code> the <code>chdir</code> argument specifies if the working directory should be changed during the evaluation of the <code>file</code> argument (which in this case has to be a path name).</p>
<div class="TODO">
<p>XXX</p>
</div>
</div>
<div id="exercise-6" class="section level2 unnumbered">
<h2>6.7.5.5 Exercise</h2>
<div class="question">
<p>Can we go over the source code of <code>capture.output</code> and <code>capture.output2</code>?</p>
</div>
<p>There were several new terms here to me when going over this function:</p>
<ul>
<li><code>stderr</code> error output</li>
<li><code>stdout</code> normal output</li>
</ul>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" data-line-number="1"><span class="co">#!/usr/bin/env Rscript</span></a>
<a class="sourceLine" id="cb314-2" data-line-number="2"><span class="co"># redirect.r -- experiments with warning and error messages</span></a>
<a class="sourceLine" id="cb314-3" data-line-number="3"></a>
<a class="sourceLine" id="cb314-4" data-line-number="4"><span class="co"># Get any arguments (and ignore them)</span></a>
<a class="sourceLine" id="cb314-5" data-line-number="5">arguments &lt;-<span class="st"> </span><span class="kw">commandArgs</span>(<span class="dt">trailingOnly=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb314-6" data-line-number="6"></a>
<a class="sourceLine" id="cb314-7" data-line-number="7"><span class="co"># Default</span></a>
<a class="sourceLine" id="cb314-8" data-line-number="8"><span class="kw">write</span>(<span class="st">&quot;1) write() to stderr&quot;</span>, <span class="kw">stderr</span>())</a>
<a class="sourceLine" id="cb314-9" data-line-number="9"><span class="kw">write</span>(<span class="st">&quot;1) write() to stdout&quot;</span>, <span class="kw">stdout</span>())</a>
<a class="sourceLine" id="cb314-10" data-line-number="10"><span class="kw">warning</span>(<span class="st">&quot;1) warning()&quot;</span>)</a>
<a class="sourceLine" id="cb314-11" data-line-number="11"></a>
<a class="sourceLine" id="cb314-12" data-line-number="12"><span class="co"># Ignore all warnings</span></a>
<a class="sourceLine" id="cb314-13" data-line-number="13"><span class="kw">options</span>(<span class="dt">warn =</span> <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb314-14" data-line-number="14"><span class="kw">write</span>(<span class="st">&quot;2) write() to stderr&quot;</span>, <span class="kw">stderr</span>())</a>
<a class="sourceLine" id="cb314-15" data-line-number="15"><span class="kw">write</span>(<span class="st">&quot;2) write() to stdout&quot;</span>, <span class="kw">stdout</span>())</a>
<a class="sourceLine" id="cb314-16" data-line-number="16"><span class="kw">warning</span>(<span class="st">&quot;2) warning()&quot;</span>)</a>
<a class="sourceLine" id="cb314-17" data-line-number="17"></a>
<a class="sourceLine" id="cb314-18" data-line-number="18"><span class="co"># Send all STDERR to STDOUT using sink()</span></a>
<a class="sourceLine" id="cb314-19" data-line-number="19"><span class="kw">options</span>(<span class="dt">warn =</span> <span class="dv">0</span>) <span class="co"># default setting</span></a>
<a class="sourceLine" id="cb314-20" data-line-number="20"><span class="kw">sink</span>(<span class="kw">stdout</span>(), <span class="dt">type=</span><span class="st">&quot;message&quot;</span>)</a>
<a class="sourceLine" id="cb314-21" data-line-number="21"><span class="kw">write</span>(<span class="st">&quot;3) write() to stderr&quot;</span>, <span class="kw">stderr</span>())</a>
<a class="sourceLine" id="cb314-22" data-line-number="22"><span class="kw">write</span>(<span class="st">&quot;3) write() to stdout&quot;</span>, <span class="kw">stdout</span>())</a>
<a class="sourceLine" id="cb314-23" data-line-number="23"><span class="kw">warning</span>(<span class="st">&quot;3) warning()&quot;</span>)</a>
<a class="sourceLine" id="cb314-24" data-line-number="24"></a>
<a class="sourceLine" id="cb314-25" data-line-number="25"><span class="co"># Send all STDOUT to STDERR using sink()</span></a>
<a class="sourceLine" id="cb314-26" data-line-number="26"><span class="kw">sink</span>(<span class="ot">NULL</span>, <span class="dt">type=</span><span class="st">&quot;message&quot;</span>) <span class="co"># default setting</span></a>
<a class="sourceLine" id="cb314-27" data-line-number="27"><span class="kw">sink</span>(<span class="kw">stderr</span>(), <span class="dt">type=</span><span class="st">&quot;output&quot;</span>)</a>
<a class="sourceLine" id="cb314-28" data-line-number="28"><span class="kw">write</span>(<span class="st">&quot;4) write() to stderr&quot;</span>, <span class="kw">stderr</span>())</a>
<a class="sourceLine" id="cb314-29" data-line-number="29"><span class="kw">write</span>(<span class="st">&quot;4) write() to stdout&quot;</span>, <span class="kw">stdout</span>())</a>
<a class="sourceLine" id="cb314-30" data-line-number="30"><span class="kw">warning</span>(<span class="st">&quot;4) warning()&quot;</span>)</a>
<a class="sourceLine" id="cb314-31" data-line-number="31"></a>
<a class="sourceLine" id="cb314-32" data-line-number="32"><span class="co"># Send messages and output to separate files</span></a>
<a class="sourceLine" id="cb314-33" data-line-number="33">msg &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;message.Rout&quot;</span>, <span class="dt">open=</span><span class="st">&quot;wt&quot;</span>)</a>
<a class="sourceLine" id="cb314-34" data-line-number="34">out &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;output.Rout&quot;</span>, <span class="dt">open=</span><span class="st">&quot;wt&quot;</span>)</a>
<a class="sourceLine" id="cb314-35" data-line-number="35"><span class="kw">sink</span>(msg, <span class="dt">type=</span><span class="st">&quot;message&quot;</span>)</a>
<a class="sourceLine" id="cb314-36" data-line-number="36"><span class="kw">sink</span>(out, <span class="dt">type=</span><span class="st">&quot;output&quot;</span>)</a>
<a class="sourceLine" id="cb314-37" data-line-number="37"><span class="kw">write</span>(<span class="st">&quot;5) write() to stderr&quot;</span>, <span class="kw">stderr</span>())</a>
<a class="sourceLine" id="cb314-38" data-line-number="38"><span class="kw">write</span>(<span class="st">&quot;5) write() to stdout&quot;</span>, <span class="kw">stdout</span>())</a>
<a class="sourceLine" id="cb314-39" data-line-number="39"><span class="kw">warning</span>(<span class="st">&quot;5) warning()&quot;</span>)</a></code></pre></div>
<ul>
<li><code>sink</code> diverts R output to a connection.</li>
</ul>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" data-line-number="1">zz &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;all.Rout&quot;</span>, <span class="dt">open =</span> <span class="st">&quot;wt&quot;</span>)</a>
<a class="sourceLine" id="cb315-2" data-line-number="2"><span class="kw">sink</span>(zz)</a>
<a class="sourceLine" id="cb315-3" data-line-number="3"><span class="kw">sink</span>(zz, <span class="dt">type =</span> <span class="st">&quot;message&quot;</span>)</a>
<a class="sourceLine" id="cb315-4" data-line-number="4"><span class="kw">try</span>(<span class="kw">log</span>(<span class="st">&quot;a&quot;</span>))</a></code></pre></div>
<pre><code>## Error in log(&quot;a&quot;) : non-numeric argument to mathematical function</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" data-line-number="1"><span class="co">## revert output back to the console -- only then access the file!</span></a>
<a class="sourceLine" id="cb317-2" data-line-number="2"><span class="kw">sink</span>(<span class="dt">type =</span> <span class="st">&quot;message&quot;</span>)</a>
<a class="sourceLine" id="cb317-3" data-line-number="3"><span class="kw">sink</span>()</a>
<a class="sourceLine" id="cb317-4" data-line-number="4"><span class="kw">file.show</span>(<span class="st">&quot;all.Rout&quot;</span>)</a></code></pre></div>
<ul>
<li><code>textConnection</code> allows R character vectors to be read as if they were being read from a text file.
<ul>
<li>They can capture R output to a character vector</li>
<li>They can be used to create a new character object or append to an existing one in the user’s workspace.</li>
<li>At all times the complete lines output to the connection are available in the R object. Closing the connection writes any remaining output to a final element of the character vector.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" data-line-number="1"><span class="cf">function</span> (..., <span class="dt">file =</span> <span class="ot">NULL</span>, <span class="dt">append =</span> <span class="ot">FALSE</span>, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;output&quot;</span>,</a>
<a class="sourceLine" id="cb318-2" data-line-number="2">                                                    <span class="st">&quot;message&quot;</span>), <span class="dt">split =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb318-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb318-4" data-line-number="4">  <span class="co"># Capture dots</span></a>
<a class="sourceLine" id="cb318-5" data-line-number="5">  <span class="co"># [-1L] removes the list()</span></a>
<a class="sourceLine" id="cb318-6" data-line-number="6">  args &lt;-<span class="st"> </span><span class="kw">substitute</span>(<span class="kw">list</span>(<span class="kw">cat</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)))[<span class="op">-</span>1L]</a>
<a class="sourceLine" id="cb318-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb318-8" data-line-number="8">  <span class="co"># match</span></a>
<a class="sourceLine" id="cb318-9" data-line-number="9">  type &lt;-<span class="st"> </span><span class="kw">match.arg</span>(type)</a>
<a class="sourceLine" id="cb318-10" data-line-number="10">  <span class="co"># set default return value</span></a>
<a class="sourceLine" id="cb318-11" data-line-number="11">  rval &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb318-12" data-line-number="12">  <span class="co"># set default closer</span></a>
<a class="sourceLine" id="cb318-13" data-line-number="13">  closeit &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb318-14" data-line-number="14">  <span class="co"># if file is null, then</span></a>
<a class="sourceLine" id="cb318-15" data-line-number="15">  <span class="cf">if</span> (<span class="kw">is.null</span>(file))</a>
<a class="sourceLine" id="cb318-16" data-line-number="16">    <span class="co"># If file is null, then create a write-only text connection object which will</span></a>
<a class="sourceLine" id="cb318-17" data-line-number="17">    <span class="co"># save to the variable rval in the execution environment (local = TRUE).</span></a>
<a class="sourceLine" id="cb318-18" data-line-number="18">    <span class="co"># see https://biostatmatt.com/R/R-conn-ints.pdf for gritty info on connections (and sinks)</span></a>
<a class="sourceLine" id="cb318-19" data-line-number="19">    file &lt;-<span class="st"> </span><span class="kw">textConnection</span>(<span class="st">&quot;rval&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="dt">local =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb318-20" data-line-number="20">  <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.character</span>(file))</a>
<a class="sourceLine" id="cb318-21" data-line-number="21">    <span class="co"># if &quot;file&quot; is a character vector, then interpret it as a filename.  Open a</span></a>
<a class="sourceLine" id="cb318-22" data-line-number="22">    <span class="co"># file connection in either append or write mode, depending on the value of</span></a>
<a class="sourceLine" id="cb318-23" data-line-number="23">    <span class="co"># &quot;append&quot;</span></a>
<a class="sourceLine" id="cb318-24" data-line-number="24">    file &lt;-<span class="st"> </span><span class="kw">file</span>(file, <span class="cf">if</span> (append)</a>
<a class="sourceLine" id="cb318-25" data-line-number="25">      <span class="st">&quot;a&quot;</span></a>
<a class="sourceLine" id="cb318-26" data-line-number="26">      <span class="cf">else</span> <span class="st">&quot;w&quot;</span>)</a>
<a class="sourceLine" id="cb318-27" data-line-number="27">  <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">inherits</span>(file, <span class="st">&quot;connection&quot;</span>)) {</a>
<a class="sourceLine" id="cb318-28" data-line-number="28">    <span class="co"># if &quot;file&quot; is already a connection object, check if it is open.  If not, open it</span></a>
<a class="sourceLine" id="cb318-29" data-line-number="29">    <span class="co"># in append mode, if specified, otherwise in write mode.</span></a>
<a class="sourceLine" id="cb318-30" data-line-number="30">    <span class="co"># inherits refers to the S3 class system.</span></a>
<a class="sourceLine" id="cb318-31" data-line-number="31">    <span class="co">#</span></a>
<a class="sourceLine" id="cb318-32" data-line-number="32">    <span class="co"># Browse[2]&gt; class(file)</span></a>
<a class="sourceLine" id="cb318-33" data-line-number="33">    <span class="co"># [1] &quot;textConnection&quot; &quot;connection&quot;</span></a>
<a class="sourceLine" id="cb318-34" data-line-number="34">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">isOpen</span>(file))</a>
<a class="sourceLine" id="cb318-35" data-line-number="35">      <span class="kw">open</span>(file, <span class="cf">if</span> (append)</a>
<a class="sourceLine" id="cb318-36" data-line-number="36">        <span class="st">&quot;a&quot;</span></a>
<a class="sourceLine" id="cb318-37" data-line-number="37">        <span class="cf">else</span> <span class="st">&quot;w&quot;</span>)</a>
<a class="sourceLine" id="cb318-38" data-line-number="38">    <span class="co"># if the connection is already open, don&#39;t close it in this function.</span></a>
<a class="sourceLine" id="cb318-39" data-line-number="39">    <span class="cf">else</span> closeit &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb318-40" data-line-number="40">  }</a>
<a class="sourceLine" id="cb318-41" data-line-number="41">  <span class="co"># if you get here, then you misspecified &quot;file&quot;</span></a>
<a class="sourceLine" id="cb318-42" data-line-number="42">  <span class="cf">else</span> <span class="kw">stop</span>(<span class="st">&quot;&#39;file&#39; must be NULL, a character string or a connection&quot;</span>)</a>
<a class="sourceLine" id="cb318-43" data-line-number="43">  <span class="co"># sink all output of type &quot;type&quot; into the connection &quot;file&quot;.  If you would like</span></a>
<a class="sourceLine" id="cb318-44" data-line-number="44">  <span class="co"># the output to continue to its original source, then &quot;split&quot; it.</span></a>
<a class="sourceLine" id="cb318-45" data-line-number="45">  <span class="co">#</span></a>
<a class="sourceLine" id="cb318-46" data-line-number="46">  <span class="co"># by default, messages (messages, warnings, errors) go to stderr and</span></a>
<a class="sourceLine" id="cb318-47" data-line-number="47">  <span class="co"># everything else to stdout.</span></a>
<a class="sourceLine" id="cb318-48" data-line-number="48">  <span class="kw">sink</span>(file, <span class="dt">type =</span> type, <span class="dt">split =</span> split)</a>
<a class="sourceLine" id="cb318-49" data-line-number="49">  <span class="kw">on.exit</span>({</a>
<a class="sourceLine" id="cb318-50" data-line-number="50">    <span class="co"># on exit, call sink with the same arguments and without &quot;file&quot; being specified.</span></a>
<a class="sourceLine" id="cb318-51" data-line-number="51">    <span class="co"># this will cause the sink from the line before to terminate.</span></a>
<a class="sourceLine" id="cb318-52" data-line-number="52">    <span class="kw">sink</span>(<span class="dt">type =</span> type, <span class="dt">split =</span> split)</a>
<a class="sourceLine" id="cb318-53" data-line-number="53">    <span class="co"># Close the connection (always, unless &quot;file&quot; was provided as</span></a>
<a class="sourceLine" id="cb318-54" data-line-number="54">    <span class="co"># an already open connection)</span></a>
<a class="sourceLine" id="cb318-55" data-line-number="55">    <span class="cf">if</span> (closeit) <span class="kw">close</span>(file)</a>
<a class="sourceLine" id="cb318-56" data-line-number="56">  })</a>
<a class="sourceLine" id="cb318-57" data-line-number="57">  <span class="co"># store the calling environment in pf.  i.e. pf refers to the environment in</span></a>
<a class="sourceLine" id="cb318-58" data-line-number="58">  <span class="co"># which capture.output was called.</span></a>
<a class="sourceLine" id="cb318-59" data-line-number="59">  pf &lt;-<span class="st"> </span><span class="kw">parent.frame</span>()</a>
<a class="sourceLine" id="cb318-60" data-line-number="60">  <span class="co"># define a local function which will evaluate its sole argument (expr) in the</span></a>
<a class="sourceLine" id="cb318-61" data-line-number="61">  <span class="co"># parent frame.</span></a>
<a class="sourceLine" id="cb318-62" data-line-number="62">  evalVis &lt;-<span class="st"> </span><span class="cf">function</span>(expr) <span class="kw">withVisible</span>(<span class="kw">eval</span>(expr, pf))</a>
<a class="sourceLine" id="cb318-63" data-line-number="63">  <span class="co"># for each argument collected in the dot dot dot.</span></a>
<a class="sourceLine" id="cb318-64" data-line-number="64">  <span class="co">#</span></a>
<a class="sourceLine" id="cb318-65" data-line-number="65">  <span class="co"># use split = TRUE to help you debug at this point.  When you try to poke around</span></a>
<a class="sourceLine" id="cb318-66" data-line-number="66">  <span class="co"># with the sink applied, you are rightfully stymied because all output is going</span></a>
<a class="sourceLine" id="cb318-67" data-line-number="67">  <span class="co"># to the sink connection!</span></a>
<a class="sourceLine" id="cb318-68" data-line-number="68">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(args)) {</a>
<a class="sourceLine" id="cb318-69" data-line-number="69">    <span class="co"># store the argument in expr</span></a>
<a class="sourceLine" id="cb318-70" data-line-number="70">    expr &lt;-<span class="st"> </span>args[[i]]</a>
<a class="sourceLine" id="cb318-71" data-line-number="71">    <span class="co"># based on the mode of the expr, evaluate it.</span></a>
<a class="sourceLine" id="cb318-72" data-line-number="72">    tmp &lt;-<span class="st"> </span><span class="cf">switch</span>(<span class="kw">mode</span>(expr),</a>
<a class="sourceLine" id="cb318-73" data-line-number="73">                  <span class="dt">expression =</span> <span class="kw">lapply</span>(expr, evalVis),</a>
<a class="sourceLine" id="cb318-74" data-line-number="74">                  <span class="dt">call =</span> ,</a>
<a class="sourceLine" id="cb318-75" data-line-number="75">                  <span class="dt">name =</span> <span class="kw">list</span>(<span class="kw">evalVis</span>(expr)),</a>
<a class="sourceLine" id="cb318-76" data-line-number="76">                  <span class="kw">stop</span>(<span class="st">&quot;bad argument&quot;</span>))</a>
<a class="sourceLine" id="cb318-77" data-line-number="77">    <span class="co"># print any visible values output during evaluation.</span></a>
<a class="sourceLine" id="cb318-78" data-line-number="78">    <span class="co"># This print will be collected by the sink we set up earlier and saved to</span></a>
<a class="sourceLine" id="cb318-79" data-line-number="79">    <span class="co"># the file connection.</span></a>
<a class="sourceLine" id="cb318-80" data-line-number="80">    <span class="cf">for</span> (item <span class="cf">in</span> tmp) <span class="cf">if</span> (item<span class="op">$</span>visible)</a>
<a class="sourceLine" id="cb318-81" data-line-number="81">      <span class="kw">print</span>(item<span class="op">$</span>value)</a>
<a class="sourceLine" id="cb318-82" data-line-number="82">  }</a>
<a class="sourceLine" id="cb318-83" data-line-number="83">  <span class="co"># calling on.exit with no arguments will clear the exit handler.</span></a>
<a class="sourceLine" id="cb318-84" data-line-number="84">  <span class="co"># we are doing this because the on.exit was designed to safeguard the sink</span></a>
<a class="sourceLine" id="cb318-85" data-line-number="85">  <span class="co"># and files being closed in the case of an exception when evaluating the</span></a>
<a class="sourceLine" id="cb318-86" data-line-number="86">  <span class="co"># passed in arguments.</span></a>
<a class="sourceLine" id="cb318-87" data-line-number="87">  <span class="kw">on.exit</span>()</a>
<a class="sourceLine" id="cb318-88" data-line-number="88">  <span class="co"># undo the sink</span></a>
<a class="sourceLine" id="cb318-89" data-line-number="89">  <span class="kw">sink</span>(<span class="dt">type =</span> type, <span class="dt">split =</span> split)</a>
<a class="sourceLine" id="cb318-90" data-line-number="90">  <span class="co"># close the file if necessary</span></a>
<a class="sourceLine" id="cb318-91" data-line-number="91">  <span class="cf">if</span> (closeit)</a>
<a class="sourceLine" id="cb318-92" data-line-number="92">    <span class="kw">close</span>(file)</a>
<a class="sourceLine" id="cb318-93" data-line-number="93">  <span class="co"># return the captured output or null invisibly otherwise.</span></a>
<a class="sourceLine" id="cb318-94" data-line-number="94">  <span class="cf">if</span> (<span class="kw">is.null</span>(rval))</a>
<a class="sourceLine" id="cb318-95" data-line-number="95">    <span class="kw">invisible</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb318-96" data-line-number="96">  <span class="cf">else</span> rval</a>
<a class="sourceLine" id="cb318-97" data-line-number="97">}</a></code></pre></div>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb319-1" data-line-number="1">capture.output2 &lt;-<span class="st"> </span><span class="cf">function</span>(code) {</a>
<a class="sourceLine" id="cb319-2" data-line-number="2">  temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb319-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">file.remove</span>(temp), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb319-4" data-line-number="4"></a>
<a class="sourceLine" id="cb319-5" data-line-number="5">  <span class="kw">sink</span>(temp)</a>
<a class="sourceLine" id="cb319-6" data-line-number="6">  <span class="kw">on.exit</span>(<span class="kw">sink</span>(), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb319-7" data-line-number="7"></a>
<a class="sourceLine" id="cb319-8" data-line-number="8">  <span class="kw">force</span>(code)</a>
<a class="sourceLine" id="cb319-9" data-line-number="9">  <span class="kw">readLines</span>(temp)</a>
<a class="sourceLine" id="cb319-10" data-line-number="10">}</a></code></pre></div>
<p>The second function will always sink output to a temporary file, and then return the results by reading the file back in (and returning a character vector). It uses two exit handlers, one to clean up the temporary file, and one to remove the sink.</p>
</div>
<div id="replacement-functions" class="section level2 unnumbered">
<h2>6.8.4 Replacement functions</h2>
<div class="question">
<p>Can we put into words the translation for</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb320-2" data-line-number="2"><span class="kw">names</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" data-line-number="1"><span class="kw">names</span>(x)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;two&quot;</span></a>
<a class="sourceLine" id="cb322-2" data-line-number="2"><span class="kw">names</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;a&quot;   &quot;two&quot; &quot;c&quot;</code></pre>
<p>Being equal to</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" data-line-number="1"><span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span> &lt;-<span class="st"> </span>x</a>
<a class="sourceLine" id="cb324-2" data-line-number="2">x &lt;-<span class="st"> `</span><span class="dt">names&lt;-</span><span class="st">`</span>(<span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span>, <span class="st">`</span><span class="dt">[&lt;-</span><span class="st">`</span>(<span class="kw">names</span>(<span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span>), <span class="dv">2</span>, <span class="st">&quot;two&quot;</span>))</a>
<a class="sourceLine" id="cb324-3" data-line-number="3"><span class="kw">rm</span>(<span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span>)</a></code></pre></div>
</div>
<p>We can dig into the <a href="https://github.com/wch/r-source/blob/2cdea4811caa2417e2cf32a0c7ad3be70325eec1/src/main/eval.c#L2787">source code</a>, but the jist is that in order to implement these complex assignments:</p>
<ol style="list-style-type: decimal">
<li>Copy <code>x</code> into a temporary variable <code>*temp*</code></li>
<li><code>[&lt;-(names(*tmp*), 2, &quot;two&quot;)</code> modifies the second element of the names of <code>*temp*</code>,</li>
<li><code>names&lt;-</code>(<code>*tmp*</code> assigns step 2 to <code>*temp*</code> names</li>
<li>Clean up by removing the temp variable</li>
</ol>
</div>
<div id="exercise-7" class="section level2 unnumbered">
<h2>6.8.6.3 Exercise</h2>
<div class="question">
<p><a href="https://github.com/Tazinho/Advanced-R-Solutions/blob/5043d9b06c7469a010c568ecb85e12bedca75207/2-06-Functions.Rmd#L433">This question is flagged as “started” let’s try to complete it!</a></p>
</div>
<p><strong><span class="Q">Q</span></strong>: Explain why the following code fails:</p>
<p><code>r     modify(get(&quot;x&quot;), 1) &lt;- 10     #&gt; Error: target of assignment expands to non-language object</code></p>
<p><strong><span class="started">A</span></strong>: First, let’s define <code>x</code> and recall the definition of <code>modify()</code> from the textbook:</p>
<p>```r
x &lt;- 1:3</p>
<p><code>modify&lt;-</code> &lt;- function(x, position, value) {
x[position] &lt;- value
x
}
```</p>
<div class="TODO">
<p>XXX</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="control-flow.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="environments.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/06-functions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["AdvancedR_Companion.pdf", "AdvancedR_Companion.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
